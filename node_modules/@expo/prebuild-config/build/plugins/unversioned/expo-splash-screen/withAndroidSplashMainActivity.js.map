{"version":3,"file":"withAndroidSplashMainActivity.js","sourceRoot":"","sources":["../../../../src/plugins/unversioned/expo-splash-screen/withAndroidSplashMainActivity.ts"],"names":[],"mappings":"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","sourcesContent":["import { AndroidConfig, ConfigPlugin, withMainActivity } from '@expo/config-plugins';\nimport { mergeContents, removeContents } from '@expo/config-plugins/build/utils/generateCode';\nimport { ExpoConfig } from '@expo/config-types';\nimport Debug from 'debug';\n\nimport { getAndroidSplashConfig } from './getAndroidSplashConfig';\n\nconst debug = Debug('expo:prebuild-config:expo-splash-screen:android:mainActivity');\n\n// DO NOT CHANGE\nconst SHOW_SPLASH_ID = 'expo-splash-screen-mainActivity-onCreate-show-splash';\n\nexport const withAndroidSplashMainActivity: ConfigPlugin = config => {\n  return withMainActivity(config, config => {\n    config.modResults.contents = setSplashScreenMainActivity(\n      config,\n      config.modResults.contents,\n      config.modResults.language\n    );\n    return config;\n  });\n};\n\nexport function setSplashScreenMainActivity(\n  config: Pick<ExpoConfig, 'android' | 'androidStatusBar' | 'userInterfaceStyle'>,\n  mainActivity: string,\n  language: 'java' | 'kt'\n): string {\n  debug(`Modify with language: \"${language}\"`);\n  const splashConfig = getAndroidSplashConfig(config);\n\n  if (!splashConfig) {\n    // Remove our generated code safely...\n    const mod = removeContents({\n      src: mainActivity,\n      tag: SHOW_SPLASH_ID,\n    });\n\n    mainActivity = mod.contents;\n    if (mod.didClear) {\n      debug('Removed SplashScreen.show()');\n    }\n    return mainActivity;\n  }\n  // TODO: Translucent is weird\n  const statusBarTranslucent = !!config.androidStatusBar?.translucent;\n\n  const { resizeMode } = splashConfig;\n  const isJava = language === 'java';\n  const LE = isJava ? ';' : '';\n\n  mainActivity = AndroidConfig.UserInterfaceStyle.addJavaImports(\n    mainActivity,\n    [\n      'expo.modules.splashscreen.SplashScreen',\n      'expo.modules.splashscreen.SplashScreenImageResizeMode',\n      'android.os.Bundle',\n    ],\n    isJava\n  );\n\n  if (!mainActivity.match(/(?<=^.*super\\.onCreate.*$)/m)) {\n    const onCreateBlock = isJava\n      ? [\n          '    @Override',\n          '    protected void onCreate(Bundle savedInstanceState) {',\n          '      super.onCreate(savedInstanceState);',\n          '    }',\n        ]\n      : [\n          '    override fun onCreate(savedInstanceState: Bundle?) {',\n          '      super.onCreate(savedInstanceState)',\n          '    }',\n        ];\n\n    mainActivity = mergeContents({\n      src: mainActivity,\n      // insert just below super.onCreate\n      anchor: isJava\n        ? /(?<=public\\s+class\\s+.*\\s+extends\\s+.*\\s+{.*$)/m\n        : /(?<=class\\s+.*\\s+:\\s+.*\\s+{.*$)/m,\n      offset: 1,\n      comment: '//',\n      tag: 'expo-splash-screen-mainActivity-onCreate',\n      newSrc: onCreateBlock.join('\\n'),\n    }).contents;\n  }\n\n  // Remove our generated code safely...\n  mainActivity = removeContents({\n    src: mainActivity,\n    tag: SHOW_SPLASH_ID,\n  }).contents;\n\n  // Remove code from `@expo/configure-splash-screen`\n  mainActivity = mainActivity\n    .split('\\n')\n    .filter(line => {\n      return !/SplashScreen\\.show\\(this,\\s?SplashScreenImageResizeMode\\./.test(line);\n    })\n    .join('\\n');\n\n  // Reapply generated code.\n  mainActivity = mergeContents({\n    src: mainActivity,\n    // insert just below super.onCreate\n    anchor: /(?<=^.*super\\.onCreate.*$)/m,\n    offset: 1,\n    comment: '//',\n    tag: SHOW_SPLASH_ID,\n    newSrc: `    SplashScreen.show(this, SplashScreenImageResizeMode.${resizeMode.toUpperCase()}, ReactRootView${\n      isJava ? '.class' : '::class.java'\n    }, ${statusBarTranslucent})${LE}`,\n  }).contents;\n\n  // TODO: Remove old `SplashScreen.show`\n\n  return mainActivity;\n}\n"]}