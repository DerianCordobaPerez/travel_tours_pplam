{"version":3,"file":"withAndroidIcons.js","sourceRoot":"","sources":["../../../src/plugins/icons/withAndroidIcons.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AndroidConfig,\n  ConfigPlugin,\n  withAndroidColors,\n  withDangerousMod,\n} from '@expo/config-plugins';\nimport { ResourceXML } from '@expo/config-plugins/build/android/Resources';\nimport { ExpoConfig } from '@expo/config-types';\nimport { compositeImagesAsync, generateImageAsync } from '@expo/image-utils';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nconst { Colors } = AndroidConfig;\n\ntype DPIString = 'mdpi' | 'hdpi' | 'xhdpi' | 'xxhdpi' | 'xxxhdpi';\ntype dpiMap = Record<DPIString, { folderName: string; scale: number }>;\n\nexport const dpiValues: dpiMap = {\n  mdpi: { folderName: 'mipmap-mdpi', scale: 1 },\n  hdpi: { folderName: 'mipmap-hdpi', scale: 1.5 },\n  xhdpi: { folderName: 'mipmap-xhdpi', scale: 2 },\n  xxhdpi: { folderName: 'mipmap-xxhdpi', scale: 3 },\n  xxxhdpi: { folderName: 'mipmap-xxxhdpi', scale: 4 },\n};\nconst BASELINE_PIXEL_SIZE = 48;\nexport const ANDROID_RES_PATH = 'android/app/src/main/res/';\nconst MIPMAP_ANYDPI_V26 = 'mipmap-anydpi-v26';\nconst ICON_BACKGROUND = 'iconBackground';\nconst IC_LAUNCHER_PNG = 'ic_launcher.png';\nconst IC_LAUNCHER_ROUND_PNG = 'ic_launcher_round.png';\nconst IC_LAUNCHER_BACKGROUND_PNG = 'ic_launcher_background.png';\nconst IC_LAUNCHER_FOREGROUND_PNG = 'ic_launcher_foreground.png';\nconst IC_LAUNCHER_XML = 'ic_launcher.xml';\nconst IC_LAUNCHER_ROUND_XML = 'ic_launcher_round.xml';\n\nexport const withAndroidIcons: ConfigPlugin = config => {\n  const { foregroundImage, backgroundColor, backgroundImage } = getAdaptiveIcon(config);\n  const icon = foregroundImage ?? getIcon(config);\n\n  if (!icon) {\n    return config;\n  }\n\n  // Apply colors.xml changes\n  config = withAndroidAdaptiveIconColors(config, backgroundColor);\n  return withDangerousMod(config, [\n    'android',\n    async config => {\n      await setIconAsync(config.modRequest.projectRoot, {\n        icon,\n        backgroundColor,\n        backgroundImage,\n        isAdaptive: !!config.android?.adaptiveIcon,\n      });\n      return config;\n    },\n  ]);\n};\n\nconst withAndroidAdaptiveIconColors: ConfigPlugin<string | null> = (config, backgroundColor) => {\n  return withAndroidColors(config, config => {\n    config.modResults = setBackgroundColor(backgroundColor ?? '#FFFFFF', config.modResults);\n    return config;\n  });\n};\n\nexport function getIcon(config: ExpoConfig) {\n  return config.icon || config.android?.icon || null;\n}\n\nexport function getAdaptiveIcon(config: ExpoConfig) {\n  return {\n    foregroundImage: config.android?.adaptiveIcon?.foregroundImage ?? null,\n    backgroundColor: config.android?.adaptiveIcon?.backgroundColor ?? null,\n    backgroundImage: config.android?.adaptiveIcon?.backgroundImage ?? null,\n  };\n}\n\n/**\n * Resizes the user-provided icon to create a set of legacy icon files in\n * their respective \"mipmap\" directories for <= Android 7, and creates a set of adaptive\n * icon files for > Android 7 from the adaptive icon files (if provided).\n */\nexport async function setIconAsync(\n  projectRoot: string,\n  {\n    icon,\n    backgroundColor,\n    backgroundImage,\n    isAdaptive,\n  }: {\n    icon: string | null;\n    backgroundColor: string | null;\n    backgroundImage: string | null;\n    isAdaptive: boolean;\n  }\n) {\n  if (!icon) {\n    return null;\n  }\n\n  await configureLegacyIconAsync(projectRoot, icon, backgroundImage, backgroundColor);\n\n  await configureAdaptiveIconAsync(projectRoot, icon, backgroundImage, isAdaptive);\n\n  return true;\n}\n\n/**\n * Configures legacy icon files to be used on Android 7 and earlier. If adaptive icon configuration\n * was provided, we create a pseudo-adaptive icon by layering the provided files (or background\n * color if no backgroundImage is provided. If no backgroundImage and no backgroundColor are provided,\n * the background is set to transparent.)\n */\nasync function configureLegacyIconAsync(\n  projectRoot: string,\n  icon: string,\n  backgroundImage: string | null,\n  backgroundColor: string | null\n) {\n  await Promise.all(\n    Object.values(dpiValues).map(async ({ folderName, scale }) => {\n      const dpiFolderPath = path.resolve(projectRoot, ANDROID_RES_PATH, folderName);\n      const iconSizePx = BASELINE_PIXEL_SIZE * scale;\n\n      // backgroundImage overrides backgroundColor\n      backgroundColor = backgroundImage ? 'transparent' : backgroundColor ?? 'transparent';\n\n      let squareIconImage: Buffer = (\n        await generateImageAsync(\n          { projectRoot, cacheType: 'android-standard-square' },\n          {\n            src: icon,\n            width: iconSizePx,\n            height: iconSizePx,\n            resizeMode: 'cover',\n            backgroundColor,\n          }\n        )\n      ).source;\n      let roundIconImage: Buffer = (\n        await generateImageAsync(\n          { projectRoot, cacheType: 'android-standard-circle' },\n          {\n            src: icon,\n            width: iconSizePx,\n            height: iconSizePx,\n            resizeMode: 'cover',\n            backgroundColor,\n            borderRadius: iconSizePx / 2,\n          }\n        )\n      ).source;\n\n      if (backgroundImage) {\n        // Layer the buffers we just created on top of the background image that's provided\n        const squareBackgroundLayer = (\n          await generateImageAsync(\n            { projectRoot, cacheType: 'android-standard-square-background' },\n            {\n              src: backgroundImage,\n              width: iconSizePx,\n              height: iconSizePx,\n              resizeMode: 'cover',\n              backgroundColor: 'transparent',\n            }\n          )\n        ).source;\n        const roundBackgroundLayer = (\n          await generateImageAsync(\n            { projectRoot, cacheType: 'android-standard-round-background' },\n            {\n              src: backgroundImage,\n              width: iconSizePx,\n              height: iconSizePx,\n              resizeMode: 'cover',\n              backgroundColor: 'transparent',\n              borderRadius: iconSizePx / 2,\n            }\n          )\n        ).source;\n        squareIconImage = await compositeImagesAsync({\n          foreground: squareIconImage,\n          background: squareBackgroundLayer,\n        });\n        roundIconImage = await compositeImagesAsync({\n          foreground: roundIconImage,\n          background: roundBackgroundLayer,\n        });\n      }\n\n      await fs.ensureDir(dpiFolderPath);\n      await fs.writeFile(path.resolve(dpiFolderPath, IC_LAUNCHER_PNG), squareIconImage);\n      await fs.writeFile(path.resolve(dpiFolderPath, IC_LAUNCHER_ROUND_PNG), roundIconImage);\n    })\n  );\n}\n\n/**\n * Configures adaptive icon files to be used on Android 8 and up. A foreground image must be provided,\n * and will have a transparent background unless:\n * - A backgroundImage is provided, or\n * - A backgroundColor was specified\n */\nexport async function configureAdaptiveIconAsync(\n  projectRoot: string,\n  foregroundImage: string,\n  backgroundImage: string | null,\n  isAdaptive: boolean\n) {\n  await Promise.all(\n    Object.values(dpiValues).map(async ({ folderName, scale }) => {\n      const dpiFolderPath = path.resolve(projectRoot, ANDROID_RES_PATH, folderName);\n      const iconSizePx = BASELINE_PIXEL_SIZE * scale;\n\n      try {\n        const adpativeIconForeground = (\n          await generateImageAsync(\n            { projectRoot, cacheType: 'android-adaptive-foreground' },\n            {\n              src: foregroundImage,\n              width: iconSizePx,\n              height: iconSizePx,\n              resizeMode: 'cover',\n              backgroundColor: 'transparent',\n            }\n          )\n        ).source;\n        await fs.writeFile(\n          path.resolve(dpiFolderPath, IC_LAUNCHER_FOREGROUND_PNG),\n          adpativeIconForeground\n        );\n\n        if (backgroundImage) {\n          const adpativeIconBackground = (\n            await generateImageAsync(\n              { projectRoot, cacheType: 'android-adaptive-background' },\n              {\n                src: backgroundImage,\n                width: iconSizePx,\n                height: iconSizePx,\n                resizeMode: 'cover',\n                backgroundColor: 'transparent',\n              }\n            )\n          ).source;\n          await fs.writeFile(\n            path.resolve(dpiFolderPath, IC_LAUNCHER_BACKGROUND_PNG),\n            adpativeIconBackground\n          );\n        } else {\n          // Remove any instances of ic_launcher_background.png that are there from previous icons\n          await removeBackgroundImageFilesAsync(projectRoot);\n        }\n      } catch (e) {\n        throw new Error('Encountered an issue resizing adaptive app icon: ' + e);\n      }\n    })\n  );\n\n  // create ic_launcher.xml and ic_launcher_round.xml\n  const icLauncherXmlString = createAdaptiveIconXmlString(backgroundImage);\n  await createAdaptiveIconXmlFiles(\n    projectRoot,\n    icLauncherXmlString,\n    // If the user only defined icon and not android.adaptiveIcon, then skip enabling the layering system\n    // this will scale the image down and present it uncropped.\n    isAdaptive\n  );\n}\n\nfunction setBackgroundColor(backgroundColor: string | null, colors: ResourceXML) {\n  return Colors.assignColorValue(colors, {\n    value: backgroundColor,\n    name: ICON_BACKGROUND,\n  });\n}\n\nexport const createAdaptiveIconXmlString = (backgroundImage: string | null) => {\n  let background = `<background android:drawable=\"@color/iconBackground\"/>`;\n  if (backgroundImage) {\n    background = `<background android:drawable=\"@mipmap/ic_launcher_background\"/>`;\n  }\n\n  return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<adaptive-icon xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    ${background}\n    <foreground android:drawable=\"@mipmap/ic_launcher_foreground\"/>\n</adaptive-icon>`;\n};\n\nasync function createAdaptiveIconXmlFiles(\n  projectRoot: string,\n  icLauncherXmlString: string,\n  add: boolean\n) {\n  const anyDpiV26Directory = path.resolve(projectRoot, ANDROID_RES_PATH, MIPMAP_ANYDPI_V26);\n  await fs.ensureDir(anyDpiV26Directory);\n  const launcherPath = path.resolve(anyDpiV26Directory, IC_LAUNCHER_XML);\n  const launcherRoundPath = path.resolve(anyDpiV26Directory, IC_LAUNCHER_ROUND_XML);\n  if (add) {\n    await fs.writeFile(launcherPath, icLauncherXmlString);\n    await fs.writeFile(launcherRoundPath, icLauncherXmlString);\n  } else {\n    // Remove the xml if the icon switches from adaptive to standard.\n    await Promise.all(\n      [launcherPath, launcherRoundPath].map(async path => {\n        if (fs.existsSync(path)) {\n          return await fs.remove(path);\n        }\n      })\n    );\n  }\n}\n\nasync function removeBackgroundImageFilesAsync(projectRoot: string) {\n  return await Promise.all(\n    Object.values(dpiValues).map(async ({ folderName }) => {\n      const dpiFolderPath = path.resolve(projectRoot, ANDROID_RES_PATH, folderName);\n      await fs.remove(path.resolve(dpiFolderPath, IC_LAUNCHER_BACKGROUND_PNG));\n    })\n  );\n}\n"]}