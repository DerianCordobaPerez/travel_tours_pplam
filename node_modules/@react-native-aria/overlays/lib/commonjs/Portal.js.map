{"version":3,"sources":["Portal.tsx"],"names":["PortalContext","React","createContext","globalOverlayCounter","PortalProvider","props","items","setItems","useState","setOverlayItem","item","overlayId","prev","concat","id","node","updateOverlayItem","map","removeOverlayItem","newItems","filter","children","OverlayView","StyleSheet","absoluteFill","OverlayProvider","OverlayContainer","context","usePortalProvider","useRef","undefined","contents","current","useContext"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport type { ReactNode } from 'react';\nimport { StyleSheet, View, ViewProps } from 'react-native';\n\ntype OverlayItem = {\n  id: number;\n  node: ReactNode;\n};\n\ninterface PortalContext {\n  items: Array<OverlayItem>;\n  setOverlayItem: (node: ReactNode) => number;\n  removeOverlayItem: (id: number) => void;\n  updateOverlayItem: (id: number, node: ReactNode) => void;\n}\n\ninterface ModalProviderProps extends ViewProps {\n  children: ReactNode;\n  provider?: boolean;\n}\n\nconst PortalContext = React.createContext<PortalContext | null>(null);\n\nlet globalOverlayCounter = 0;\n\nexport function PortalProvider(props: { children: ReactNode }) {\n  const [items, setItems] = React.useState<Array<OverlayItem>>([]);\n\n  const setOverlayItem = (item: ReactNode) => {\n    const overlayId = ++globalOverlayCounter;\n    setItems((prev) => prev.concat([{ id: overlayId, node: item }]));\n    return overlayId;\n  };\n\n  const updateOverlayItem = (id: number, node: ReactNode) => {\n    setItems((prev) =>\n      prev.map((item) => {\n        if (item.id === id) {\n          return { id, node };\n        }\n        return item;\n      })\n    );\n  };\n\n  const removeOverlayItem = (id: number) => {\n    setItems((prev) => {\n      const newItems = prev.filter((item) => item.id !== id);\n      return newItems;\n    });\n  };\n\n  return (\n    <PortalContext.Provider\n      value={{ items, setOverlayItem, removeOverlayItem, updateOverlayItem }}\n    >\n      {props.children}\n\n      {/* Render Overlays */}\n      {items.map((item) => {\n        return <React.Fragment key={item.id}>{item.node}</React.Fragment>;\n      })}\n    </PortalContext.Provider>\n  );\n}\n\nfunction OverlayView(props: ModalProviderProps) {\n  return (\n    <View\n      pointerEvents=\"box-none\"\n      style={StyleSheet.absoluteFill}\n      collapsable={false}\n      {...props}\n    />\n  );\n}\n\nexport const OverlayProvider = PortalProvider;\n\nexport function OverlayContainer(props: ModalProviderProps) {\n  const context = usePortalProvider();\n  const overlayId = React.useRef<number | undefined>(undefined);\n  let contents = <OverlayView {...props} />;\n\n  useEffect(\n    () => {\n      // Mount\n      if (overlayId.current === undefined) {\n        overlayId.current = context?.setOverlayItem(contents);\n      }\n      // Update\n      else {\n        if (overlayId.current) {\n          context?.updateOverlayItem(overlayId.current, contents);\n        }\n      }\n    },\n    // To re-render the child\n    [props]\n  );\n\n  // Unmount\n  useEffect(() => {\n    return () => {\n      if (overlayId.current) {\n        context?.removeOverlayItem(overlayId.current);\n      }\n    };\n  }, []);\n\n  return null;\n}\n\nfunction usePortalProvider() {\n  const context = React.useContext(PortalContext);\n  return context;\n}\n"]}