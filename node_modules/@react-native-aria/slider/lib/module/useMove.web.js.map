{"version":3,"sources":["useMove.web.ts"],"names":["disableTextSelection","restoreTextSelection","useMemo","useRef","useGlobalListeners","useMove","props","onMoveStart","onMove","onMoveEnd","state","didMove","lastPosition","id","addGlobalListener","removeGlobalListener","moveProps","start","current","move","pointerType","deltaX","deltaY","type","end","PointerEvent","onMouseMove","e","button","pageX","pageY","onMouseUp","window","onMouseDown","stopPropagation","preventDefault","onTouchMove","touch","changedTouches","findIndex","identifier","onTouchEnd","onTouchStart","length","triggerKeyboardMove","onKeyDown","key"],"mappings":"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","sourcesContent":["/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { disableTextSelection, restoreTextSelection } from './textSelection';\nimport { MoveEvents, PointerType } from '@react-types/shared';\nimport React, { HTMLAttributes, useMemo, useRef } from 'react';\nimport { useGlobalListeners } from '@react-aria/utils';\n\ninterface MoveResult {\n  /** Props to spread on the target element. */\n  moveProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles move interactions across mouse, touch, and keyboard, including dragging with\n * the mouse or touch, and using the arrow keys. Normalizes behavior across browsers and\n * platforms, and ignores emulated mouse events on touch devices.\n */\nexport function useMove(props: MoveEvents): MoveResult {\n  let { onMoveStart, onMove, onMoveEnd } = props;\n\n  let state = useRef<{\n    didMove: boolean;\n    lastPosition: { pageX: number; pageY: number } | null;\n    id: number | null;\n  }>({ didMove: false, lastPosition: null, id: null });\n\n  let { addGlobalListener, removeGlobalListener } = useGlobalListeners();\n\n  let moveProps = useMemo(() => {\n    let moveProps: HTMLAttributes<HTMLElement> = {};\n\n    let start = () => {\n      disableTextSelection();\n      state.current.didMove = false;\n    };\n    let move = (pointerType: PointerType, deltaX: number, deltaY: number) => {\n      if (deltaX === 0 && deltaY === 0) {\n        return;\n      }\n\n      if (!state.current.didMove) {\n        state.current.didMove = true;\n        onMoveStart?.({\n          type: 'movestart',\n          pointerType,\n        });\n      }\n      onMove({\n        type: 'move',\n        pointerType,\n        deltaX: deltaX,\n        deltaY: deltaY,\n      });\n    };\n    let end = (pointerType: PointerType) => {\n      restoreTextSelection();\n      if (state.current.didMove) {\n        onMoveEnd?.({\n          type: 'moveend',\n          pointerType,\n        });\n      }\n    };\n\n    if (typeof PointerEvent !== 'undefined') {\n      let onMouseMove = (e: MouseEvent) => {\n        if (e.button === 0) {\n          move(\n            'mouse',\n            e.pageX - state.current.lastPosition.pageX,\n            e.pageY - state.current.lastPosition.pageY\n          );\n          state.current.lastPosition = { pageX: e.pageX, pageY: e.pageY };\n        }\n      };\n      let onMouseUp = (e: MouseEvent) => {\n        if (e.button === 0) {\n          end('mouse');\n          removeGlobalListener(window, 'mousemove', onMouseMove, false);\n          removeGlobalListener(window, 'mouseup', onMouseUp, false);\n        }\n      };\n      moveProps.onMouseDown = (e: React.MouseEvent) => {\n        if (e.button === 0) {\n          start();\n          e.stopPropagation();\n          e.preventDefault();\n          state.current.lastPosition = { pageX: e.pageX, pageY: e.pageY };\n          addGlobalListener(window, 'mousemove', onMouseMove, false);\n          addGlobalListener(window, 'mouseup', onMouseUp, false);\n        }\n      };\n\n      let onTouchMove = (e: TouchEvent) => {\n        // @ts-ignore\n        let touch = [...e.changedTouches].findIndex(\n          ({ identifier }) => identifier === state.current.id\n        );\n        if (touch >= 0) {\n          let { pageX, pageY } = e.changedTouches[touch];\n          move(\n            'touch',\n            pageX - state.current.lastPosition.pageX,\n            pageY - state.current.lastPosition.pageY\n          );\n          state.current.lastPosition = { pageX, pageY };\n        }\n      };\n      let onTouchEnd = (e: TouchEvent) => {\n        // @ts-ignore\n        let touch = [...e.changedTouches].findIndex(\n          ({ identifier }) => identifier === state.current.id\n        );\n        if (touch >= 0) {\n          end('touch');\n          state.current.id = null;\n          removeGlobalListener(window, 'touchmove', onTouchMove);\n          removeGlobalListener(window, 'touchend', onTouchEnd);\n          removeGlobalListener(window, 'touchcancel', onTouchEnd);\n        }\n      };\n      moveProps.onTouchStart = (e: React.TouchEvent) => {\n        if (e.changedTouches.length === 0 || state.current.id != null) {\n          return;\n        }\n\n        let { pageX, pageY, identifier } = e.changedTouches[0];\n        start();\n        e.stopPropagation();\n        e.preventDefault();\n        state.current.lastPosition = { pageX, pageY };\n        state.current.id = identifier;\n        addGlobalListener(window, 'touchmove', onTouchMove, false);\n        addGlobalListener(window, 'touchend', onTouchEnd, false);\n        addGlobalListener(window, 'touchcancel', onTouchEnd, false);\n      };\n    }\n\n    let triggerKeyboardMove = (deltaX: number, deltaY: number) => {\n      start();\n      move('keyboard', deltaX, deltaY);\n      end('keyboard');\n    };\n\n    moveProps.onKeyDown = (e) => {\n      switch (e.key) {\n        case 'Left':\n        case 'ArrowLeft':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(-1, 0);\n          break;\n        case 'Right':\n        case 'ArrowRight':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(1, 0);\n          break;\n        case 'Up':\n        case 'ArrowUp':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(0, -1);\n          break;\n        case 'Down':\n        case 'ArrowDown':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(0, 1);\n          break;\n      }\n    };\n\n    return moveProps;\n  }, [\n    state,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n    addGlobalListener,\n    removeGlobalListener,\n  ]);\n\n  return { moveProps };\n}\n"]}